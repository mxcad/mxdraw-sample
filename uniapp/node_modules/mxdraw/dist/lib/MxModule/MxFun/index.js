import{createReandomId}from"../../tools/algorithm/random";import{createCanvas,createCanvasParent}from"../../tools/dom/create";import MxDrawObject from"../MxDrawObject";import store from"../store";import useCanvasResizeListener from"../useCanvasResizeListener";import MrxDbgUiPrPoint from"../MrxDbgUiPrPoint";import mxDefaultUiData from"../loadCoreCode/mxUiData";import MxDbDatabase from"../MxDbDatabase";import MxCADObject from"../MxCADObject";let mxUiData=mxDefaultUiData;class MxFunClass{constructor(){this.listenForUpdateCursor=(e=>{mxUiData.mountUpdateCursorFun(e)})}createMxObject({canvasId:e=createReandomId(),cadFile:t="",callback:r,isNewFile:o=!1,useWebsocket:n=!1,isAutoResize:a=!0,mapBox:s,isMxCAD:u=!1,userIdentitySign:i="emptyUserIdentity"}){if(this.initUiDataObject(mxUiData),!n&&o&&(o=!1),s){const e=s.canvas;store.state.MxFun.createMxObject(e,t,t=>{let o=new MxDrawObject(t);t.setIniset({EnableOsnapFunction:!0}),r&&r(o,{canvas:e,canvasParent:void 0})},void 0,o,n,s)}else{const s=createCanvas(e),d=createCanvasParent(s);d.parentNode&&11!=d.parentNode.nodeType||document.body.appendChild(d);let c=void 0;u&&(c=!0,n=!0),store.state.MxFun.createMxObject(e,t,e=>{let t=new MxDrawObject(e);if(u){const t=2;0==i.length&&(i="invalidUserIdentity"),e.initRunMode(t),e.initUserLoginData(i,"")}e.setMouseRightRotate(!1),e.setIniset({EnableOsnapFunction:!0}),e.addEvent("onResize",()=>(d.tabindex=3,{width:d.clientWidth,height:d.clientHeight})),a&&useCanvasResizeListener(t,s),r&&r(t,{canvas:s,canvasParent:d})},c,o,n,void 0)}}setMxServer(e="ws://localhost:5090"){store.state.MxFun.setMxServer(e)}enablStaticLoad(e){store.state.MxFun.enablStaticLoad(e)}setStaticServer(e){store.state.MxFun.setStaticServer(e)}addCommand(e,t){store.state.MxFun.addCommand(e,t)}sendStringToExecute(e,...t){return store.state.MxFun.sendStringToExecute(e,...t)}call(e,t,r){return store.state.MxFun.call(e,t,r)}getCurrentDraw(){return new MxDrawObject(store.state.MxFun.getCurrentDraw())}getCurrentDatabase(){let e=store.state.MxFun.getCurrentDraw();return new MxDbDatabase(e.getMxDatabase())}screenCoordLong2World(e){return store.state.MxFun.screenCoordLong2World(e)}screenCoordLong2Doc(e){return store.state.MxFun.screenCoordLong2Doc(e)}docCoordLong2Screen(e){return store.state.MxFun.docCoordLong2Screen(e)}worldCoordLong2Doc(e){return store.state.MxFun.worldCoordLong2Doc(e)}docCoordLong2World(e){return store.state.MxFun.docCoordLong2World(e)}screenCoord2World(e,t,r){return store.state.MxFun.screenCoord2World(e,t,r)}worldCoord2Screen(e,t,r){return store.state.MxFun.worldCoord2Screen(e,t,r)}docCoord2World(e,t,r){return store.state.MxFun.docCoord2World(e,t,r)}worldCoord2Doc(e,t,r){return store.state.MxFun.worldCoord2Doc(e,t,r)}screenCoord2Doc(e,t){return store.state.MxFun.screenCoord2Doc(e,t,0)}docCoord2Screen(e,t){return store.state.MxFun.docCoord2Screen(e,t,0)}updateDisplay(){return store.state.MxFun.updateDisplay()}addWindowsEvent(e){return store.state.MxFun.addWindowsEvent(e)}isRunningCommand(){return store.state.MxFun.isRunningCommand()}zoomW(e,t,r,o,n){return store.state.MxFun.zoomW(e,t,r,o,n)}showLayer(e,t,r){return store.state.MxFun.showLayer(e,t,r)}getCurrentMxCAD(){let e=store.state.MxFun.getCurrentMxCAD();return new MxCADObject(e)}getQueryString(e){return store.state.MxFun.getQueryString(e)}setIniset(e){return store.state.MxFun.setIniset(e)}upDisplayForLayerData(e){return store.state.MxFun.upDisplayForLayerData(e)}initUiDataObject(e){return mxUiData=e,store.state.MxFun.initUiDataObject(e)}getUIData(){return mxUiData}testMX(e){return 11}loadImageMaterial(e,t){return t?(store.state.MxFun.loadImageMaterial(e,t),new Promise((e,t)=>{e(null)})):new Promise((t,r)=>{store.state.MxFun.loadImageMaterial(e,e=>{t(e||null)})})}openFile(e,t=!1){return store.state.MxFun.openFile(e,t)}addToCurrentSpace(e){return this.getCurrentDraw().addMxEntity(e)}selectEnt(e,t=null){return new Promise((r,o)=>{const n=new MrxDbgUiPrPoint;n.setMessage(e),n.go(e=>{if(0!=e)return void r(0);const o=n.value();let a=this.getCurrentDraw().findMxEntityAtPoint(o),s=0;for(;0!=a.length;){let e=a.length;for(let r=0;r<e;r++){let e=a[r];if(!t||!t.type||t.type==e.getTypeName()){s=e.objectId();break}}break}r(s)})})}listenForCommandLineInput(e){mxUiData.getCmdLine().mountUpDisplayFun(e)}setCommandLineInputData(e,t){mxUiData.getCmdLine().setCmdText(e),mxUiData.onKeydown(t)}listenForCoordTip(e){mxUiData.mountSetCoordFun(e)}getMxFunTHREE(){return store.state.MxFun.getTHREE()}getMxFunThreeTool(){return store.state.MxFun.getMxThreeJS()}ceneratecursor(e=128,t=10,r=!0,o){return store.state.MxFun.ceneratecursor(e,t,r,o)}callCommand(e,t,r){return store.state.MxFun.callCommand(e,t,r)}cadCoord2Doc(e,t,r){return store.state.MxFun.cadCoord2Doc(e,t,r)}docCoord2Cad(e,t,r){return store.state.MxFun.docCoord2Cad(e,t,r)}getMxEntity(e){return store.state.MxFun.getMxEntity(e)}getCurrentMousePostion(){let e=store.state.MxFun.getCurrentMousePostion();return new THREE.Vector3(e.x,e.y,0)}stopRunCommand(){return store.state.MxFun.stopRunCommand()}}const MxFun=new MxFunClass;export default MxFun;