var __awaiter=this&&this.__awaiter||function(t,i,n,e){return new(n||(n=Promise))(function(o,r){function a(t){try{m(e.next(t))}catch(t){r(t)}}function s(t){try{m(e.throw(t))}catch(t){r(t)}}function m(t){var i;t.done?o(t.value):(i=t.value,i instanceof n?i:new n(function(t){t(i)})).then(a,s)}m((e=e.apply(t,i||[])).next())})};import{dynamicCreateMxObject,dynamicImport}from"../../tools/dynamicImport";import store from"../store";import mxfun from"./mxfun.es5.js";import mxcadassemblyinit from"./mxcadassembly_es5.js";import{registerMxDbEntity}from"../../tools/registerMxDbEntity";function rxInitMxEntity(){var t;null===(t=store.state.MxFun)||void 0===t||t.initDynamicCreate(dynamicCreateMxObject)}export default function loadCoreCode(){return __awaiter(this,void 0,void 0,function*(){return new Promise((t,i)=>__awaiter(this,void 0,void 0,function*(){try{if(store.state.MxFun)return console.error("mx loadCoreCode ady call"),void t();window.$=window.jQuery=yield dynamicImport("jquery"),window.MxDocumentReady=void 0,window.MxUiMain=(t=>{const i=t("./MxFun").MxFun;window.THREE=i.getTHREE(),store.commit("setMxFun",i),store.events.emit("MxUiMain",t),window.MxUiMain=void 0}),window.MxMain=(i=>(store.events.emit("MxMain",i),window.MxMain=void 0,rxInitMxEntity(),registerMxDbEntity(),t(),0)),mxcadassemblyinit().then(function(t){store.commit("setMxassembly",t)}),mxfun()}catch(t){i({code:"error",msg:t})}}))})};