import{addRegisterMxDbEntity}from"../../tools/registerMxDbEntity";import MxDbEntity from"../MxDbEntity";import MxThreeJS from"../MxThreeJS";import drawMxDbLeadTag from"./draw";class MxDbLeadTag extends MxDbEntity{constructor(){super(...arguments),this.point=new THREE.Vector3,this.leadLen=88,this.text="",this.textHeight=24}getTypeName(){return"MxDbLeadTag"}createDots(e,t){const{x:n,y:o,z:r}=e,i=new THREE.Shape;i.arc(n,o,t.screenCoordLong2Doc(6),0,2*Math.PI,!0);const s=new THREE.Path;s.arc(n,o,t.screenCoordLong2Doc(3),0,2*Math.PI,!0),i.holes.push(s);const a=new THREE.ShapeGeometry(i),d=new THREE.MeshPhongMaterial({color:"#ff0000",transparent:!0}),x=new THREE.Shape;x.arc(n,o,t.screenCoordLong2Doc(3),0,2*Math.PI,!0);const c=new THREE.ShapeGeometry(x),E=new THREE.MeshPhongMaterial({color:"#e2da8f",transparent:!0}),h=new THREE.Mesh(a,d),g=new THREE.Mesh(c,E);return h.add(g),h}worldDraw(e){let t=e.getMxObject();const n=this.createDots(this.point,t);if(e.drawEntity(n),n.geometry.computeBoundingBox(),e.drawSelectLine(n.geometry.boundingBox.max,n.geometry.boundingBox.min),2===e.getType())return;let o=e.getMxObject().screenCoordLong2Doc(this.leadLen),r=new THREE.Vector3(this.point.x+2*o,this.point.y+o,0);const i=r.x-o,s=new THREE.Vector3(i,r.y,r.z);e.setLineWidth(4),e.setColor("#ffe605"),e.drawLines([this.point,s,r]);const a=e.getMxObject().screenCoordLong2Doc(this.textHeight),d=r.clone().setX(r.x);e.setColor(16744448);const x=MxThreeJS.creatTextSprite(this.text,d,a,0,e.getColor());if(x){const t=new THREE.Box3,n=new THREE.Vector3;t.expandByObject(x),t.getSize(n),x.position.setX(x.position.x+n.x/2);const o=e.getMxObject().screenCoordLong2Doc(5),r=t.min.clone().setX(t.min.x+n.x/2).setY(t.min.y-o),i=t.max.clone().setX(t.max.x+n.x/2).setY(t.min.y+o);i.setY(t.max.y+o);const s=new THREE.Vector3(r.x,i.y),a=new THREE.Vector3(i.x,r.y);e.setColor("#ffffff"),e.setLineWidth(0),e.drawLine(r,s),e.drawLine(i,a),e.drawLine(r,a),e.drawLine(s,i);const d=o/2,c=[],E=[];c.push(new THREE.Vector3(s.x+d,s.y-o,s.z),new THREE.Vector3(s.x+d,s.y-d,s.z),new THREE.Vector3(s.x+o,s.y-d,s.z)),E.push(new THREE.Vector3(a.x-d,a.y+o,a.z),new THREE.Vector3(a.x-d,a.y+d,a.z),new THREE.Vector3(a.x-o,a.y+d,a.z)),e.drawLines(c),e.drawLines(E),e.setOpacity(.5),e.setColor("#663244"),e.setRenderOrder(-100),e.drawSolid([r,s,i,a]),e.setRenderOrder(100),e.drawEntity(x)}}getGripPoints(){return[this.point]}onViewChange(){return this.setNeedUpdateDisplay(),!0}moveGripPointsAt(e,t){return 0===e&&this.point.add(t),!0}dwgIn(e){return this.onDwgIn(e),this.dwgInHelp(e,["point","text","textHeight","leadLen"]),!0}dwgOut(e){return this.onDwgOut(e),this.dwgOutHelp(e,["point","text","textHeight","leadLen"]),e}}MxDbLeadTag.cmd="Mx_LeadTag",MxDbLeadTag.draw=drawMxDbLeadTag,addRegisterMxDbEntity(MxDbLeadTag);export default MxDbLeadTag;