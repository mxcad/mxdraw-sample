{
  "version": 3,
  "sources": ["../../mxdraw/dist/lib/MxModule/MxDbAlignedDimension/index.js", "../../mxdraw/dist/lib/MxModule/MxDbAlignedDimension/draw.js"],
  "sourcesContent": ["import{addRegisterMxDbEntity}from\"../../tools/registerMxDbEntity\";import _ from\"lodash\";import McGiWorldDrawType from\"../McGiWorldDrawType\";import MxDbEntity from\"../MxDbEntity\";import MxThreeJS from\"../MxThreeJS\";import drawMxDbAlignedDimension from\"./draw\";const propertyDbKeys=[\"point1\",\"point2\",\"fontColor\"];class MxDbAlignedDimension extends MxDbEntity{constructor(t){if(super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,t){const{points:e,fontColor:n}=t;e&&this.setPoints(e),n&&(this.fontColor=n)}}setPoints(t){const[e,n]=t;e&&(this.point1=e),n&&(this.point2=n)}getTypeName(){return\"MxDbAlignedDimension\"}getDirection(t,e,n){const i=new THREE.Vector3(t.x,t.y,0),o=new THREE.Vector3(1,0,0),r=t.angleTo(o);let a=-1;(r<7*Math.PI/18||r>10*Math.PI/18)&&e.x>n.x&&(a=1);const s=new THREE.Matrix4;return s.makeRotationZ(Math.PI/2*a),i.applyMatrix4(s),i}getDimText(){return new THREE.Vector3(this.point1.x-this.point2.x,this.point1.y-this.point2.y,0).length().toFixed(3)}worldDraw(t){if(t.getType()==McGiWorldDrawType.kWorldDraw||t.getType()==McGiWorldDrawType.kDynDragDraw){const e=this.point1,n=this.point2;let i,o,r,a,s,x,y;const c=new THREE.Vector3(e.x-n.x,e.y-n.y,0),p=this.getDirection(c,e,n),E=new THREE.Matrix4;E.makeScale(.01,.01,.01);const l=new THREE.Vector3(p.x,p.y,0);l.applyMatrix4(E);const h=new THREE.Vector3(e.x+l.x,e.y+l.y,0),w=new THREE.Vector3(n.x+l.x,n.y+l.y,0),M=this.getColor();x=MxThreeJS.createPoint(e,M),y=MxThreeJS.createPoint(n,M);{E.identity(),E.makeScale(.2,.2,0),new THREE.Vector3(p.x,p.y,0).applyMatrix4(E),E.identity(),E.makeScale(.02,.02,0);const r=new THREE.Vector3(p.x,p.y,0);r.applyMatrix4(E),t.drawLine(h,w),i=MxThreeJS.createLine(new THREE.Vector3(h.x+2*r.x,h.y+2*r.y,0),new THREE.Vector3(e.x+r.x,e.y+r.y,0),M),o=MxThreeJS.createLine(new THREE.Vector3(w.x+2*r.x,w.y+2*r.y,0),new THREE.Vector3(n.x+r.x,n.y+r.y,0),M)}{const i=new THREE.Vector3(1,0,0);let o=c.angleTo(i);const a=new THREE.Vector3(p.x,p.y,0);a.normalize();const s=e.distanceTo(n);c.y<0?o=o<Math.PI/2?2*Math.PI-o:Math.PI-o:o>Math.PI/2&&(o=Math.PI+o);const x=t.getMxObject();x&&(o-=x.getViewAngle());const y=this.getDimText();null!=(r=MxThreeJS.creatTextSprite(y,new THREE.Vector3(w.x+c.x/2+a.x*s/30,w.y+c.y/2+a.y*s/30,0),.07*s,o,this.fontColor||M))&&t.drawEntity(r)}{E.identity(),E.makeScale(.08,.08,.08);const t=new THREE.Matrix4;t.makeRotationZ(17*Math.PI/18);let e=new THREE.Vector3(c.x,c.y,0);e.applyMatrix4(E),e.applyMatrix4(t),t.identity(),t.makeRotationZ(17*-Math.PI/18);let n=new THREE.Vector3(c.x,c.y,0);n.applyMatrix4(E),n.applyMatrix4(t);const i=new Array;i.push(new THREE.Vector3(h.x,h.y,0),new THREE.Vector3(h.x+e.x,h.y+e.y,0),new THREE.Vector3(h.x+n.x,h.y+n.y,0)),a=MxThreeJS.createTriangle(i,M),t.identity(),t.makeRotationZ(Math.PI/18),(e=new THREE.Vector3(c.x,c.y,0)).applyMatrix4(E),e.applyMatrix4(t),t.identity(),t.makeRotationZ(-Math.PI/18),(n=new THREE.Vector3(c.x,c.y,0)).applyMatrix4(E),n.applyMatrix4(t);const o=new Array;o.push(new THREE.Vector3(w.x,w.y,0),new THREE.Vector3(w.x+e.x,w.y+e.y,0),new THREE.Vector3(w.x+n.x,w.y+n.y,0)),s=MxThreeJS.createTriangle(o,M)}t.drawEntity(i),t.drawEntity(o),a&&t.drawEntity(a),s&&t.drawEntity(s),t.drawEntity(x),t.drawEntity(y)}else t.drawLine(this.point1,this.point2)}setPoint1(t){this.point1=t}setPoint2(t){this.point2=t}setColor(t){return _.isArray(t)?([this.color=this.color,this.fontColor=this.fontColor||this.color]=t,console.log(\"this.fontColor : \",this.fontColor)):this.color=t,this}getGripPoints(){let t=[];return t.push(this.point1),t.push(this.point2),t}moveGripPointsAt(t,e){return 0==t?this.point1.add(e):(t=1)&&this.point2.add(e),!0}dwgIn(t){return this.onDwgIn(t),this.dwgInHelp(t,propertyDbKeys),!0}dwgOut(t){return this.onDwgOut(t),this.dwgOutHelp(t,propertyDbKeys),t}create(){return new MxDbAlignedDimension}}MxDbAlignedDimension.cmd=\"Mx_DimensionMeasurement\",MxDbAlignedDimension.draw=drawMxDbAlignedDimension,addRegisterMxDbEntity(MxDbAlignedDimension);export default MxDbAlignedDimension;", "import MxDbAlignedDimension from\".\";import McEdGetPointWorldDrawObject from\"../McEdGetPointWorldDrawObject\";import MrxDbgUiPrPoint from\"../MrxDbgUiPrPoint\";import MxFun from\"../MxFun\";import MxType from\"../MxType\";export default function drawMxDbAlignedDimension(){let t=new MxDbAlignedDimension;const e=new MrxDbgUiPrPoint;return e.setMessage(\"\\n指定第一点:\"),e.go(n=>{if(0!=n)return;const o=e.value();t.setPoint1(o),t.setColor(65314);const r=new McEdGetPointWorldDrawObject;r.setDraw(e=>{t.setPoint2(e),r.drawCustomEntity(t)}),e.setBasePt(o),e.setUseBasePt(!0),e.setUserDraw(r),e.setMessage(\"\\n指定第二点:\"),e.setInputToucheType(MxType.InputToucheType.kGetEnd),e.go(n=>{if(0!=n)return void console.log(n);const o=e.value();t.setPoint2(o),MxFun.getCurrentDraw().addMxEntity(t)})}),t};"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAkE,oBAAa;;;ACAsJ,SAAR,2BAA2C;AAAC,MAAI,IAAE,IAAI;AAAqB,QAAM,IAAE,IAAI;AAAgB,SAAO,EAAE,WAAW,UAAU,GAAE,EAAE,GAAG,OAAG;AAAC,QAAG,KAAG;AAAE;AAAO,UAAM,IAAE,EAAE,MAAM;AAAE,MAAE,UAAU,CAAC,GAAE,EAAE,SAAS,KAAK;AAAE,UAAM,IAAE,IAAI;AAA4B,MAAE,QAAQ,CAAAA,OAAG;AAAC,QAAE,UAAUA,EAAC,GAAE,EAAE,iBAAiB,CAAC;AAAA,IAAC,CAAC,GAAE,EAAE,UAAU,CAAC,GAAE,EAAE,aAAa,IAAE,GAAE,EAAE,YAAY,CAAC,GAAE,EAAE,WAAW,UAAU,GAAE,EAAE,mBAAmB,eAAO,gBAAgB,OAAO,GAAE,EAAE,GAAG,CAAAC,OAAG;AAAC,UAAG,KAAGA;AAAE,eAAO,KAAK,QAAQ,IAAIA,EAAC;AAAE,YAAMC,KAAE,EAAE,MAAM;AAAE,QAAE,UAAUA,EAAC,GAAE,cAAM,eAAe,EAAE,YAAY,CAAC;AAAA,IAAC,CAAC;AAAA,EAAC,CAAC,GAAE;AAAC;;;ADAlgB,IAAM,iBAAe,CAAC,UAAS,UAAS,WAAW;AAAE,IAAM,uBAAN,cAAmC,WAAU;AAAA,EAAC,YAAY,GAAE;AAAC,QAAG,MAAM,GAAE,KAAK,SAAO,IAAI,MAAM,WAAQ,KAAK,SAAO,IAAI,MAAM,WAAQ,GAAE;AAAC,YAAK,EAAC,QAAO,GAAE,WAAU,EAAC,IAAE;AAAE,WAAG,KAAK,UAAU,CAAC,GAAE,MAAI,KAAK,YAAU;AAAA,IAAE;AAAA,EAAC;AAAA,EAAC,UAAU,GAAE;AAAC,UAAK,CAAC,GAAE,CAAC,IAAE;AAAE,UAAI,KAAK,SAAO,IAAG,MAAI,KAAK,SAAO;AAAA,EAAE;AAAA,EAAC,cAAa;AAAC,WAAM;AAAA,EAAsB;AAAA,EAAC,aAAa,GAAE,GAAE,GAAE;AAAC,UAAM,IAAE,IAAI,MAAM,QAAQ,EAAE,GAAE,EAAE,GAAE,CAAC,GAAE,IAAE,IAAI,MAAM,QAAQ,GAAE,GAAE,CAAC,GAAE,IAAE,EAAE,QAAQ,CAAC;AAAE,QAAI,IAAE;AAAG,KAAC,IAAE,IAAE,KAAK,KAAG,MAAI,IAAE,KAAG,KAAK,KAAG,OAAK,EAAE,IAAE,EAAE,MAAI,IAAE;AAAG,UAAM,IAAE,IAAI,MAAM;AAAQ,WAAO,EAAE,cAAc,KAAK,KAAG,IAAE,CAAC,GAAE,EAAE,aAAa,CAAC,GAAE;AAAA,EAAC;AAAA,EAAC,aAAY;AAAC,WAAO,IAAI,MAAM,QAAQ,KAAK,OAAO,IAAE,KAAK,OAAO,GAAE,KAAK,OAAO,IAAE,KAAK,OAAO,GAAE,CAAC,EAAE,OAAO,EAAE,QAAQ,CAAC;AAAA,EAAC;AAAA,EAAC,UAAU,GAAE;AAAC,QAAG,EAAE,QAAQ,KAAG,0BAAkB,cAAY,EAAE,QAAQ,KAAG,0BAAkB,cAAa;AAAC,YAAM,IAAE,KAAK,QAAO,IAAE,KAAK;AAAO,UAAI,GAAE,GAAE,GAAE,GAAE,GAAE,GAAE;AAAE,YAAM,IAAE,IAAI,MAAM,QAAQ,EAAE,IAAE,EAAE,GAAE,EAAE,IAAE,EAAE,GAAE,CAAC,GAAE,IAAE,KAAK,aAAa,GAAE,GAAE,CAAC,GAAE,IAAE,IAAI,MAAM;AAAQ,QAAE,UAAU,MAAI,MAAI,IAAG;AAAE,YAAM,IAAE,IAAI,MAAM,QAAQ,EAAE,GAAE,EAAE,GAAE,CAAC;AAAE,QAAE,aAAa,CAAC;AAAE,YAAM,IAAE,IAAI,MAAM,QAAQ,EAAE,IAAE,EAAE,GAAE,EAAE,IAAE,EAAE,GAAE,CAAC,GAAE,IAAE,IAAI,MAAM,QAAQ,EAAE,IAAE,EAAE,GAAE,EAAE,IAAE,EAAE,GAAE,CAAC,GAAE,IAAE,KAAK,SAAS;AAAE,UAAE,kBAAU,YAAY,GAAE,CAAC,GAAE,IAAE,kBAAU,YAAY,GAAE,CAAC;AAAE;AAAC,UAAE,SAAS,GAAE,EAAE,UAAU,KAAG,KAAG,CAAC,GAAE,IAAI,MAAM,QAAQ,EAAE,GAAE,EAAE,GAAE,CAAC,EAAE,aAAa,CAAC,GAAE,EAAE,SAAS,GAAE,EAAE,UAAU,MAAI,MAAI,CAAC;AAAE,cAAMC,KAAE,IAAI,MAAM,QAAQ,EAAE,GAAE,EAAE,GAAE,CAAC;AAAE,QAAAA,GAAE,aAAa,CAAC,GAAE,EAAE,SAAS,GAAE,CAAC,GAAE,IAAE,kBAAU,WAAW,IAAI,MAAM,QAAQ,EAAE,IAAE,IAAEA,GAAE,GAAE,EAAE,IAAE,IAAEA,GAAE,GAAE,CAAC,GAAE,IAAI,MAAM,QAAQ,EAAE,IAAEA,GAAE,GAAE,EAAE,IAAEA,GAAE,GAAE,CAAC,GAAE,CAAC,GAAE,IAAE,kBAAU,WAAW,IAAI,MAAM,QAAQ,EAAE,IAAE,IAAEA,GAAE,GAAE,EAAE,IAAE,IAAEA,GAAE,GAAE,CAAC,GAAE,IAAI,MAAM,QAAQ,EAAE,IAAEA,GAAE,GAAE,EAAE,IAAEA,GAAE,GAAE,CAAC,GAAE,CAAC;AAAA,MAAC;AAAC;AAAC,cAAMC,KAAE,IAAI,MAAM,QAAQ,GAAE,GAAE,CAAC;AAAE,YAAIC,KAAE,EAAE,QAAQD,EAAC;AAAE,cAAME,KAAE,IAAI,MAAM,QAAQ,EAAE,GAAE,EAAE,GAAE,CAAC;AAAE,QAAAA,GAAE,UAAU;AAAE,cAAMC,KAAE,EAAE,WAAW,CAAC;AAAE,UAAE,IAAE,IAAEF,KAAEA,KAAE,KAAK,KAAG,IAAE,IAAE,KAAK,KAAGA,KAAE,KAAK,KAAGA,KAAEA,KAAE,KAAK,KAAG,MAAIA,KAAE,KAAK,KAAGA;AAAG,cAAMG,KAAE,EAAE,YAAY;AAAE,QAAAA,OAAIH,MAAGG,GAAE,aAAa;AAAG,cAAMC,KAAE,KAAK,WAAW;AAAE,iBAAO,IAAE,kBAAU,gBAAgBA,IAAE,IAAI,MAAM,QAAQ,EAAE,IAAE,EAAE,IAAE,IAAEH,GAAE,IAAEC,KAAE,IAAG,EAAE,IAAE,EAAE,IAAE,IAAED,GAAE,IAAEC,KAAE,IAAG,CAAC,GAAE,OAAIA,IAAEF,IAAE,KAAK,aAAW,CAAC,MAAI,EAAE,WAAW,CAAC;AAAA,MAAC;AAAC;AAAC,UAAE,SAAS,GAAE,EAAE,UAAU,MAAI,MAAI,IAAG;AAAE,cAAMK,KAAE,IAAI,MAAM;AAAQ,QAAAA,GAAE,cAAc,KAAG,KAAK,KAAG,EAAE;AAAE,YAAIC,KAAE,IAAI,MAAM,QAAQ,EAAE,GAAE,EAAE,GAAE,CAAC;AAAE,QAAAA,GAAE,aAAa,CAAC,GAAEA,GAAE,aAAaD,EAAC,GAAEA,GAAE,SAAS,GAAEA,GAAE,cAAc,KAAG,CAAC,KAAK,KAAG,EAAE;AAAE,YAAIE,KAAE,IAAI,MAAM,QAAQ,EAAE,GAAE,EAAE,GAAE,CAAC;AAAE,QAAAA,GAAE,aAAa,CAAC,GAAEA,GAAE,aAAaF,EAAC;AAAE,cAAMN,KAAE,IAAI;AAAM,QAAAA,GAAE,KAAK,IAAI,MAAM,QAAQ,EAAE,GAAE,EAAE,GAAE,CAAC,GAAE,IAAI,MAAM,QAAQ,EAAE,IAAEO,GAAE,GAAE,EAAE,IAAEA,GAAE,GAAE,CAAC,GAAE,IAAI,MAAM,QAAQ,EAAE,IAAEC,GAAE,GAAE,EAAE,IAAEA,GAAE,GAAE,CAAC,CAAC,GAAE,IAAE,kBAAU,eAAeR,IAAE,CAAC,GAAEM,GAAE,SAAS,GAAEA,GAAE,cAAc,KAAK,KAAG,EAAE,IAAGC,KAAE,IAAI,MAAM,QAAQ,EAAE,GAAE,EAAE,GAAE,CAAC,GAAG,aAAa,CAAC,GAAEA,GAAE,aAAaD,EAAC,GAAEA,GAAE,SAAS,GAAEA,GAAE,cAAc,CAAC,KAAK,KAAG,EAAE,IAAGE,KAAE,IAAI,MAAM,QAAQ,EAAE,GAAE,EAAE,GAAE,CAAC,GAAG,aAAa,CAAC,GAAEA,GAAE,aAAaF,EAAC;AAAE,cAAML,KAAE,IAAI;AAAM,QAAAA,GAAE,KAAK,IAAI,MAAM,QAAQ,EAAE,GAAE,EAAE,GAAE,CAAC,GAAE,IAAI,MAAM,QAAQ,EAAE,IAAEM,GAAE,GAAE,EAAE,IAAEA,GAAE,GAAE,CAAC,GAAE,IAAI,MAAM,QAAQ,EAAE,IAAEC,GAAE,GAAE,EAAE,IAAEA,GAAE,GAAE,CAAC,CAAC,GAAE,IAAE,kBAAU,eAAeP,IAAE,CAAC;AAAA,MAAC;AAAC,QAAE,WAAW,CAAC,GAAE,EAAE,WAAW,CAAC,GAAE,KAAG,EAAE,WAAW,CAAC,GAAE,KAAG,EAAE,WAAW,CAAC,GAAE,EAAE,WAAW,CAAC,GAAE,EAAE,WAAW,CAAC;AAAA,IAAC;AAAM,QAAE,SAAS,KAAK,QAAO,KAAK,MAAM;AAAA,EAAC;AAAA,EAAC,UAAU,GAAE;AAAC,SAAK,SAAO;AAAA,EAAC;AAAA,EAAC,UAAU,GAAE;AAAC,SAAK,SAAO;AAAA,EAAC;AAAA,EAAC,SAAS,GAAE;AAAC,WAAO,cAAAQ,QAAE,QAAQ,CAAC,KAAG,CAAC,KAAK,QAAM,KAAK,OAAM,KAAK,YAAU,KAAK,aAAW,KAAK,KAAK,IAAE,GAAE,QAAQ,IAAI,qBAAoB,KAAK,SAAS,KAAG,KAAK,QAAM,GAAE;AAAA,EAAI;AAAA,EAAC,gBAAe;AAAC,QAAI,IAAE,CAAC;AAAE,WAAO,EAAE,KAAK,KAAK,MAAM,GAAE,EAAE,KAAK,KAAK,MAAM,GAAE;AAAA,EAAC;AAAA,EAAC,iBAAiB,GAAE,GAAE;AAAC,WAAO,KAAG,IAAE,KAAK,OAAO,IAAI,CAAC,KAAG,IAAE,MAAI,KAAK,OAAO,IAAI,CAAC,GAAE;AAAA,EAAE;AAAA,EAAC,MAAM,GAAE;AAAC,WAAO,KAAK,QAAQ,CAAC,GAAE,KAAK,UAAU,GAAE,cAAc,GAAE;AAAA,EAAE;AAAA,EAAC,OAAO,GAAE;AAAC,WAAO,KAAK,SAAS,CAAC,GAAE,KAAK,WAAW,GAAE,cAAc,GAAE;AAAA,EAAC;AAAA,EAAC,SAAQ;AAAC,WAAO,IAAI;AAAA,EAAoB;AAAC;AAAC,qBAAqB,MAAI,2BAA0B,qBAAqB,OAAK,0BAAyB,sBAAsB,oBAAoB;AAAE,IAAO,+BAAQ;",
  "names": ["e", "n", "o", "r", "i", "o", "a", "s", "x", "y", "t", "e", "n", "_"]
}
