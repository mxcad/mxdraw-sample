{
  "version": 3,
  "sources": ["../../mxdraw/dist/lib/MxModule/MxDbImage/draw.js", "../../mxdraw/dist/lib/MxModule/MxDbImage/index.js"],
  "sourcesContent": ["import MxDbImage from\".\";import MrxDbgUiPrPoint from\"../MrxDbgUiPrPoint\";import MxFun from\"../MxFun\";import MxType from\"../MxType\";export default function drawMxDbImage(){const e=new MrxDbgUiPrPoint;e.setMessage(\"\\n指定插入点:\");let r=MxFun.getCurrentDraw();e.go(t=>{if(0!=t)return;let n=MxFun.screenCoordLong2Doc(300),o=MxFun.screenCoordLong2Doc(200);const d=e.value();let i=MxFun.screenCoord2Doc(10,10);d.z=i.z;let a=new MxDbImage;a.setRenderOrder(MxType.MxDefaultRenderOrder.kCADMeshRenderOrder-1),a.setPoint1(d);let x=new THREE.Vector3(d.x+n,d.y+o,d.z);a.setPoint2(x);let M=prompt(\"请填写图片网络地址\",\"https://cdn.pixabay.com/photo/2022/11/15/12/23/winter-7593872_960_720.jpg\");M&&(a.setImagePath(M),r.addMxEntity(a),a.addEvent(\"onStartGripEidt\",()=>(a.visible=!1,a.setNeedUpdateDisplay(),{renderOrder:MxType.MxDefaultRenderOrder.kCADMeshRenderOrder-1})),a.addEvent(\"onEndGripEidt\",()=>{a.visible=!0,a.setNeedUpdateDisplay()}))})};", "import{addRegisterMxDbEntity}from\"../../tools/registerMxDbEntity\";import MxDbEntity from\"../MxDbEntity\";import MxFun from\"../MxFun\";import MxType from\"../MxType\";import drawMxDbImage from\"./draw\";class MxDbImage extends MxDbEntity{constructor(){super(...arguments),this.pt1=new THREE.Vector3,this.pt2=new THREE.Vector3,this.imagePath=\"\",this.isLoadMaterialFromPath=!0,this.material=null,this.angle=0}getTypeName(){return\"MxDbImage\"}getAngle(){return this.angle}setAngle(t){this.angle=t}worldDraw(t){let e=new THREE.Vector3(this.pt1.x,this.pt2.y),i=new THREE.Vector3(this.pt2.x,this.pt1.y);if(Math.abs(this.angle)>1e-5){let e=new THREE.Vector3(.5*(this.pt1.x-this.pt2.x)+this.pt2.x,.5*(this.pt1.y-this.pt2.y)+this.pt2.y),i=new THREE.Matrix4;i.makeRotationZ(this.angle);let a=(new THREE.Matrix4).makeTranslation(e.x,e.y,e.z).multiply(i).multiply((new THREE.Matrix4).makeTranslation(-e.x,-e.y,-e.z));t.setMatrix(a)}if(1==t.getType()){if(t.drawSelectLine(this.pt1,e),t.drawSelectLine(e,this.pt2),t.drawSelectLine(this.pt2,i),t.drawSelectLine(i,this.pt1),this.material){let e=Math.abs(this.pt1.x-this.pt2.x),i=Math.abs(this.pt1.y-this.pt2.y),a=new THREE.PlaneGeometry(e,i),s=Math.min(this.pt1.x,this.pt2.x),h=Math.min(this.pt1.y,this.pt2.y);for(let t=0;t<a.vertices.length;t++)a.vertices[t].x+=s+.5*e,a.vertices[t].y+=h+.5*i,a.vertices[t].z=0;let r=new THREE.Mesh(a,this.material);r.material.depthTest=!1,t.drawEntity(r)}else if(this.imagePath.length>0&&this.isLoadMaterialFromPath){let e=this,i=t.getMxObject();MxFun.loadImageMaterial(this.imagePath,t=>{this.isLoadMaterialFromPath=!1,t&&(e.setMaterial(t),e.setNeedUpdateDisplay(),i.updateDisplay())})}}else if(this.material){let e=Math.abs(this.pt1.x-this.pt2.x),i=Math.abs(this.pt1.y-this.pt2.y),a=new THREE.PlaneGeometry(e,i),s=Math.min(this.pt1.x,this.pt2.x),h=Math.min(this.pt1.y,this.pt2.y);for(let t=0;t<a.vertices.length;t++)a.vertices[t].x+=s+.5*e,a.vertices[t].y+=h+.5*i,a.vertices[t].z=0;let r=new THREE.Mesh(a,this.material);r.material.depthTest=!1,t.drawEntity(r)}else t.drawLine(this.pt1,e),t.drawLine(e,this.pt2),t.drawLine(this.pt2,i),t.drawLine(i,this.pt1);t.setMatrix(null)}setImagePath(t){this.imagePath=t,this.isLoadMaterialFromPath=!0,this.material=null}getImagePath(){return this.imagePath}setMaterial(t){this.material=t}loadMaterial(t){t&&(this.imagePath=t),this.isLoadMaterialFromPath=!1,this.material=null;let e=this;MxFun.loadImageMaterial(this.imagePath,t=>{this.isLoadMaterialFromPath=!1,e.setMaterial(t)})}setPoint1(t){this.pt1=t}getPoint1(){return this.pt1}setPoint2(t){this.pt2=t}getPoint2(){return this.pt2}getGripPoints(){let t=[];t.push(this.pt1),t.push(this.pt2);let e=new THREE.Vector3(this.pt1.x+.5*(this.pt2.x-this.pt1.x),this.pt1.y+.5*(this.pt2.y-this.pt1.y));return t.push(e),t}moveGripPointsAt(t,e){return 0==t?this.pt1.add(e):1==t?this.pt2.add(e):2==t&&(this.pt1.add(e),this.pt2.add(e)),!0}dwgIn(t){return this.onDwgIn(t),this.pt1.copy(t.pt1),this.pt2.copy(t.pt2),this.imagePath=t.imagePath.substr(0),this.isLoadMaterialFromPath=!0,t.angle&&(this.angle=t.angle),t.material&&(this.material=t.material),!0}dwgOut(t){return this.onDwgOut(t),t.pt1=this.pt1,t.pt2=this.pt2,t.imagePath=this.imagePath,t.angle=this.angle,t.type==MxType.MxCloneType.kDragClone&&(t.material=this.material),t}create(){return new MxDbImage}}MxDbImage.cmd=\"Mx_DrawImage\",MxDbImage.draw=drawMxDbImage,addRegisterMxDbEntity(MxDbImage);export default MxDbImage;"],
  "mappings": "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",
  "names": ["e", "i", "t"]
}
