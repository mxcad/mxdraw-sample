{
  "version": 3,
  "sources": ["../../mxdraw/dist/lib/MxModule/MxDb2LineAngularDimension/index.js", "../../mxdraw/dist/lib/MxModule/MxDb2LineAngularDimension/draw.js"],
  "sourcesContent": ["import{addRegisterMxDbEntity}from\"../../tools/registerMxDbEntity\";import _ from\"lodash\";import McGiWorldDrawType from\"../McGiWorldDrawType\";import MxDbEntity from\"../MxDbEntity\";import drawMxDb2LineAngularDimension from\"./draw\";const propertyDbKeys=[\"colors\",\"point1\",\"point2\",\"point3\"];class MxDb2LineAngularDimension extends MxDbEntity{constructor(t){if(super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.point3=new THREE.Vector3,this.colors=[],t){const{points:i,colors:n}=t;i&&this.setPoints(i),n&&this.setColor(n)}}calculateLineAngle(t,i,n){const o=2*Math.PI/360;return{startAngle:180*Math.atan2(i.y-t.y,i.x-t.x)/Math.PI*o,endAngle:180*Math.atan2(n.y-t.y,n.x-t.x)/Math.PI*o}}setPoints(t){const[i,n,o]=t;return i&&(this.point1=i),n&&(this.point2=n),o&&(this.point3=o),this}setColor(t){return _.isArray(t)?this.colors=t:this.color=t,this}worldDraw(t){if(t.getType()==McGiWorldDrawType.kWorldDraw||t.getType()==McGiWorldDrawType.kDynDragDraw){const[i,n,o,e]=this.colors||[],r=this.getColor(),s=t.getMxObject();t.setColor(i||r),t.drawLine(this.point1,this.point2),t.setColor(n||r),t.drawLine(this.point2,this.point3);const{startAngle:a,endAngle:p}=this.calculateLineAngle(this.point2,this.point1,this.point3),l=this.point2.distanceTo(this.point1),h=this.point2.distanceTo(this.point3),d=Math.min(l,h)/4;let c=THREE.MathUtils.radToDeg(a-p);c<0&&(c+=360);let D=s.screenCoordLong2Doc(50);const g=new THREE.ArcCurve(this.point2.x,this.point2.y,d,a,p,!0),y=(new THREE.Geometry).setFromPoints(g.getPoints(50));t.setColor(o||r),t.drawGeometryLines(y);const w=g.getPoint(.5);let u=new THREE.Vector3(w.x,w.y,0);const M=u.sub(this.point2),m=M.length()+.5*D;M.normalize().multiplyScalar(m),u=this.point2.clone().add(M),t.setColor(e||r),t.drawText(c.toFixed(3)+\"°\",.5*D,0,u)}else t.drawLine(this.point1,this.point2),t.drawLine(this.point3,this.point2)}getGripPoints(){return[this.point1,this.point2,this.point3]}moveGripPointsAt(t,i){return 0===t?this.point1.add(i):1===t?this.point2.add(i):2===t&&this.point3.add(i),!0}dwgIn(t){return this.onDwgIn(t),this.dwgInHelp(t,propertyDbKeys),!0}dwgOut(t){return this.onDwgOut(t),this.dwgOutHelp(t,propertyDbKeys),t}create(){return new MxDb2LineAngularDimension}transformBy(t){this.point1.applyMatrix4(t),this.point2.applyMatrix4(t)}getTypeName(){return\"MxDb2LineAngularDimension\"}}MxDb2LineAngularDimension.cmd=\"Mx_AngleSurveying\",MxDb2LineAngularDimension.draw=drawMxDb2LineAngularDimension,addRegisterMxDbEntity(MxDb2LineAngularDimension);export default MxDb2LineAngularDimension;", "import MxDb2LineAngularDimension from\".\";import McEdGetPointWorldDrawObject from\"../McEdGetPointWorldDrawObject\";import MrxDbgUiPrPoint from\"../MrxDbgUiPrPoint\";import MxFun from\"../MxFun\";export default function drawMxDb2LineAngularDimension(){const n=new MrxDbgUiPrPoint,t=MxFun.getCurrentDraw(),e=new MxDb2LineAngularDimension,r=new McEdGetPointWorldDrawObject;return n.setMessage(\"\\n指定第一点:\"),n.go(o=>{0===o&&(n.setMessage(\"\\n指定第二个角度点:\"),e.point1=n.value(),r.setDraw((n,t)=>{e.point2=n,r.drawLine(e.point1,n)}),n.setUserDraw(r),n.go(o=>{n.setMessage(\"\\n指定最后一个点:\"),0===o&&(e.point2=n.value(),r.setDraw((n,t)=>{e.point3=n,r.drawCustomEntity(e)}),n.go(n=>{0===n&&t.addMxEntity(e)}))}))}),e};"],
  "mappings": "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",
  "names": ["n", "t", "o", "_"]
}
